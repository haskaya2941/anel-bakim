<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anel BakÄ±m Sistemi</title>
    <style>
        :root { --primary: #00796B; --secondary: #004D40; --accent: #FFD600; --bg: #F5F7F8; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; }
        
        /* Makine KartÄ± */
        .machine-card { background: var(--primary); color: white; padding: 20px; border-radius: 15px 15px 5px 5px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .machine-name { font-size: 20px; font-weight: bold; margin: 0; }
        .machine-code { background: var(--accent); color: #333; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 900; margin-top: 8px; }

        /* Form AlanlarÄ± */
        .content-box { background: white; padding: 20px; border-radius: 0 0 15px 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .step-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; margin-bottom: 10px; display: block; }
        
        label { display: block; margin-top: 15px; font-weight: 600; color: #444; }
        select, input, textarea { width: 100%; padding: 14px; margin-top: 8px; border: 1.5px solid #E0E0E0; border-radius: 10px; box-sizing: border-box; font-size: 16px; transition: 0.3s; }
        select:focus, input:focus { border-color: var(--primary); outline: none; background: #F0F9F8; }

        /* Butonlar */
        .btn { width: 100%; padding: 16px; margin-top: 20px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(0,121,107,0.3); }
        .btn-submit { background: #2E7D32; color: white; display: none; }
        .btn:active { transform: scale(0.98); }

        /* BakÄ±m Maddeleri */
        .maintenance-item { display: flex; align-items: flex-start; padding: 15px; border-bottom: 1px solid #F0F0F0; background: #fff; transition: 0.2s; }
        .maintenance-item:last-child { border: none; }
        input[type="checkbox"] { width: 26px; height: 26px; margin-right: 15px; accent-color: var(--primary); flex-shrink: 0; }
        .maintenance-text { font-size: 15px; color: #333; line-height: 1.4; }

        /* UyarÄ±lar */
        .error-box { background: #FFEBEE; color: #C62828; padding: 15px; border-radius: 10px; border: 1px solid #FFCDD2; margin-bottom: 15px; display: none; }
        .hidden { display: none; }
        .section-title { background: #E0F2F1; padding: 10px; border-radius: 5px; font-size: 14px; margin-top: 20px; color: var(--secondary); font-weight: bold; border-left: 4px solid var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div id="error-display" class="error-box"></div>

    <div class="machine-card">
        <p id="m_baslik" class="machine-name">QR OKUTULMADI</p>
        <div id="m_kod" class="machine-code">Sistem HazÄ±r</div>
    </div>

    <div class="content-box">
        <div id="manuel-section" class="hidden">
            <span class="step-label">HATA: Makine BulunamadÄ±</span>
            <select id="manuel-select" onchange="loadMachine(this.value)">
                <option value="">Listeden SeÃ§iniz...</option>
            </select>
        </div>

        <div id="auth-section">
            <span class="step-label">ADIM 1: Personel GiriÅŸi</span>
            <label>Personel:</label>
            <select id="personel_name">
                <option value="Hasan Kaya">Hasan Kaya</option>
                <option value="Sami Kaya">Sami Kaya</option>
                <option value="Ahmet YÄ±lmaz">Ahmet YÄ±lmaz</option>
                <option value="OperatÃ¶r">OperatÃ¶r</option>
            </select>
            <label>Åžifre:</label>
            <input type="number" id="password_input" placeholder="1234" inputmode="numeric">
            <button onclick="handleLogin()" class="btn btn-primary">GÄ°RÄ°Åž YAP VE BAÅžLA</button>
        </div>

        <form id="maintenance-form" class="hidden" method="POST" action="https://script.google.com/macros/s/AKfycbyUBmqtWUdCGIXp6WXEBuUkqwWhN5W38K7q1prjb-zKaHr7dr4Pyoc8Hxh9K_rYmjT3/exec" target="hidden_iframe">
            <span class="step-label">ADIM 2: BakÄ±m KaydÄ±</span>
            
            <input type="hidden" name="Makine" id="hidden_id">
            <input type="hidden" name="MakineAdi" id="hidden_name">
            <input type="hidden" name="Personel" id="hidden_user">

            <label>BakÄ±m Periyodu:</label>
            <select name="Periyot" id="period_select" onchange="renderChecklist()" required>
                <option value="">SeÃ§iniz...</option>
                <option value="GÃ¼nlÃ¼k">GÃ¼nlÃ¼k</option>
                <option value="HaftalÄ±k">HaftalÄ±k</option>
                <option value="AylÄ±k">AylÄ±k</option>
                <option value="3 AylÄ±k">3 AylÄ±k</option>
                <option value="6 AylÄ±k">6 AylÄ±k</option>
                <option value="YÄ±llÄ±k">YÄ±llÄ±k</option>
            </select>

            <div id="checklist-container"></div>

            <div id="notes-area" class="hidden">
                <label>ArÄ±za / Notlar:</label>
                <textarea name="Notlar" rows="3" placeholder="Varsa belirtin..."></textarea>
                <button type="submit" onclick="return validateAndSend()" class="btn btn-submit" id="submit-btn" style="display:block;">âœ… KAYDI TAMAMLA</button>
            </div>
        </form>
    </div>
</div>

<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
    // --- 266 MAKÄ°NE VERÄ°SÄ° ---
    // Buraya V50'deki o dev listeyi (hafiza ve qrMap) olduÄŸu gibi ekleyebilirsin.
    const hafiza = {
        "S-APR.A33.025": {"ad": "4'lÃ¼ YÃ¼zey Ä°kaz LambasÄ± Kapak Ã‡akma", "GÃ¼nlÃ¼k": ["Hava kaÃ§aÄŸÄ± kontrolÃ¼", "FikstÃ¼r temizliÄŸi"], "HaftalÄ±k": ["Piston mili yaÄŸlama"]},
        "S-MKN.A02.01.06": {"ad": "Enjeksiyon Makinesi No:6", "GÃ¼nlÃ¼k": ["YaÄŸ seviyesi", "Mengene temizliÄŸi"], "HaftalÄ±k": ["KolonlarÄ±n yaÄŸlanmasÄ±"]}
    };
    const qrMap = {"1": "S-APR.A33.025", "120": "S-MKN.A01.11.09", "129": "S-MKN.A02.01.06"};

    window.onload = function() {
        // Manuel listeyi doldur
        const sel = document.getElementById("manuel-select");
        Object.keys(hafiza).sort().forEach(k => {
            let opt = document.createElement("option"); opt.value = k; opt.text = k + " - " + hafiza[k].ad.substring(0,30); sel.appendChild(opt);
        });

        // QR koddan gelen linki yakala
        let path = window.location.pathname.split("/").pop().replace(".html", "").trim();
        let target = qrMap[path] || (hafiza[path.toUpperCase()] ? path.toUpperCase() : null);

        if (target) {
            loadMachine(target);
        } else {
            document.getElementById("manuel-section").classList.remove("hidden");
        }
    };

    function loadMachine(id) {
        if(!hafiza[id]) return;
        document.getElementById("m_baslik").innerText = hafiza[id].ad;
        document.getElementById("m_kod").innerText = id;
        document.getElementById("hidden_id").value = id;
        document.getElementById("hidden_name").value = hafiza[id].ad;
        document.getElementById("manuel-section").classList.add("hidden");
        document.getElementById("auth-section").classList.remove("hidden");
    }

    function handleLogin() {
        const pass = document.getElementById("password_input").value;
        const id = document.getElementById("hidden_id").value;

        if(!id) { alert("Ã–nce makine seÃ§ilmelidir!"); return; }
        if(pass === "1234") {
            document.getElementById("hidden_user").value = document.getElementById("personel_name").value;
            document.getElementById("auth-section").classList.add("hidden");
            document.getElementById("maintenance-form").classList.remove("hidden");
        } else {
            alert("Åžifre HatalÄ±! (Ä°pucu: 1234)");
        }
    }

    function renderChecklist() {
        const p = document.getElementById("period_select").value;
        const id = document.getElementById("hidden_id").value;
        const container = document.getElementById("checklist-container");
        container.innerHTML = "";
        
        if(!p) return;
        document.getElementById("notes-area").classList.remove("hidden");

        let steps = ["GÃ¼nlÃ¼k"];
        if(p !== "GÃ¼nlÃ¼k") steps.push(p);

        steps.forEach(step => {
            if(hafiza[id][step] && hafiza[id][step].length > 0) {
                container.innerHTML += `<div class="section-title">${step} Kontrolleri</div>`;
                hafiza[id][step].forEach(m => {
                    container.innerHTML += `
                        <div class="maintenance-item">
                            <input type="checkbox" class="ck" name="Yapilan_Islemler" value="[${step}] ${m}">
                            <div class="maintenance-text">${m}</div>
                        </div>`;
                });
            }
        });
    }

    function validateAndSend() {
        const checks = document.querySelectorAll(".ck");
        if(checks.length > 0 && !Array.from(checks).every(c => c.checked)) {
            alert("ðŸ›‘ LÃ¼tfen tÃ¼m maddeleri iÅŸaretlemeden kaydetmeyin!");
            return false;
        }
        alert("âœ… KayÄ±t gÃ¶nderiliyor... LÃ¼tfen bekleyin.");
        setTimeout(() => location.reload(), 2500);
        return true;
    }
</script>
</body>
</html>