<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anel BakÄ±m Sistemi</title>
    <style>
        :root { --primary: #00796B; --accent: #FFD600; --bg: #E0F2F1; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .card { background: white; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; overflow: hidden; border-top: 8px solid var(--primary); }
        
        /* Ãœst Bilgi KartÄ± */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .machine-title { font-size: 18px; margin: 0; font-weight: bold; line-height: 1.3; }
        .etiket { background: var(--accent); color: #333; padding: 4px 12px; border-radius: 5px; font-weight: 900; margin-top: 10px; font-size: 13px; display: inline-block; }

        .content { padding: 20px; }
        .step-box { background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; margin-bottom: 20px; }
        .step-title { font-size: 12px; color: #888; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 10px; }

        label { display: block; margin-top: 10px; font-weight: bold; color: #333; }
        select, input, textarea, button { width: 100%; padding: 12px; margin-top: 8px; border: 1.5px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* Butonlar */
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; height: 50px; }
        button:active { transform: scale(0.98); }
        .btn-send { background: #D32F2F; margin-top: 20px; box-shadow: 0 4px 10px rgba(211,47,47,0.3); }

        /* Maddeler */
        .item { display: flex; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid #eee; }
        input[type="checkbox"] { width: 28px; height: 28px; margin-right: 15px; accent-color: var(--primary); flex-shrink: 0; }
        .item span { font-size: 15px; color: #444; line-height: 1.4; }
        .periyot-baslik { background: #B2DFDB; padding: 8px; border-radius: 5px; font-size: 14px; margin-top: 15px; color: #004D40; font-weight: bold; border-left: 5px solid var(--primary); }
        
        .hidden { display: none; }
        #manuel-kutu { background: #FFF3E0; border: 1px solid #FFB74D; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header" id="ana-header">
        <h2 id="m_baslik" class="machine-title">YÃœKLENÄ°YOR...</h2>
        <div id="m_kod" class="etiket">---</div>
    </div>

    <div class="content">
        <div id="manuel-kutu" class="hidden">
            <p style="margin:0; color:#E65100; font-weight:bold;">âš ï¸ QR Kod TanÄ±nmadÄ±</p>
            <select id="manuel-secim" onchange="manuelSec()">
                <option value="">Listeden Makine SeÃ§iniz...</option>
            </select>
        </div>

        <div id="login-section" class="hidden">
            <span class="step-title">ADIM 1: YETKÄ°LENDÄ°RME</span>
            <label>Personel:</label>
            <select id="p_name">
                <option value="Hasan Kaya">Hasan Kaya</option>
                <option value="Sami Kaya">Sami Kaya</option>
                <option value="Ahmet YÄ±lmaz">Ahmet YÄ±lmaz</option>
                <option value="OperatÃ¶r">OperatÃ¶r</option>
            </select>
            <label>Åifre:</label>
            <input type="number" id="pass" placeholder="1234" inputmode="numeric">
            <button onclick="giris()">SÄ°STEME GÄ°RÄ°Å YAP</button>
        </div>

        <form id="main-form" class="hidden" method="POST" action="https://script.google.com/macros/s/AKfycbyOWX0tEiEqY7mpECAVlL7jvC8vmAzCc2Pw4-tTKIUW5RKZ8sGvtQelqN7SUDZRmDPY/exec" target="gizli_frame" onsubmit="return val()">
            <span class="step-title">ADIM 2: BAKIM KAYDI</span>
            
            <input type="hidden" name="Makine" id="makine_id">
            <input type="hidden" name="MakineAdi" id="makine_adi_gizli">
            <input type="hidden" name="Personel" id="hidden_user">
            
            <label>BakÄ±m Periyodu:</label>
            <select name="Periyot" id="periyot_sec" onchange="periyotDegisti()" required>
                <option value="">SeÃ§iniz...</option>
                <option value="GÃ¼nlÃ¼k">GÃ¼nlÃ¼k BakÄ±m</option>
                <option value="HaftalÄ±k">HaftalÄ±k BakÄ±m (+GÃ¼nlÃ¼k)</option>
                <option value="AylÄ±k">AylÄ±k BakÄ±m (+H+G)</option>
                <option value="3 AylÄ±k">3 AylÄ±k BakÄ±m</option>
                <option value="6 AylÄ±k">6 AylÄ±k BakÄ±m</option>
                <option value="YÄ±llÄ±k">YÄ±llÄ±k BakÄ±m</option>
            </select>

            <div id="madde_konteynir" class="hidden">
                <div id="madde_listesi"></div>
                <label>Notlar / ArÄ±za:</label>
                <textarea name="Notlar" rows="3" placeholder="Varsa notunuzu buraya yazÄ±n..."></textarea>
                <button type="submit" class="btn-send">âœ… KAYDI TAMAMLA</button>
            </div>
        </form>
    </div>
</div>

<iframe name="gizli_frame" style="display:none;"></iframe>

<script>
    // --- 266 MAKÄ°NE VERÄ° SETÄ° ---
    const hafiza = {"S-APR.A33.025": {"ad": "4'lÃ¼ YÃ¼zey Ä°kaz LambasÄ± (VBE) Kapak Ã‡akma Apr.", "GÃ¼nlÃ¼k": ["Hava kaÃ§aÄŸÄ± kontrolÃ¼", "FikstÃ¼r temizliÄŸi"], "HaftalÄ±k": ["Piston mili yaÄŸlamasÄ±"]}, "S-MKN.A01.11.09": {"ad": "TaÅŸÄ±nabilir KonveyÃ¶r", "GÃ¼nlÃ¼k": ["Bant gerginliÄŸi", "Acil stop testi"]}, "S-MKN.A02.01.06": {"ad": "Enjeksiyon Makinesi No:6", "GÃ¼nlÃ¼k": ["YaÄŸ seviyesi", "Mengene temizliÄŸi"]} /* BurayÄ± Python kodun dolduracak */};
    
    // --- QR EÅLEÅTÄ°RME TABLOSU ---
    const qrMap = {"1": "S-APR.A33.025", "120": "S-MKN.A01.11.09", "129": "S-MKN.A02.01.06" /* BurayÄ± Python kodun dolduracak */};

    window.onload = function() {
        // Listeyi yedek olarak doldur
        const select = document.getElementById("manuel-secim");
        Object.keys(hafiza).sort().forEach(key => {
            let opt = document.createElement("option"); opt.value = key; opt.text = key + " - " + hafiza[key].ad.substring(0,30); select.appendChild(opt);
        });

        // URL'den kodu al (Eski Ã§alÄ±ÅŸan mantÄ±k)
        let shortCode = window.location.pathname.split("/").pop().replace(".html", "").replace(/%20/g, " ").trim();
        let upperCode = shortCode.toUpperCase();
        
        let targetCode = qrMap[shortCode] || qrMap[upperCode] || (hafiza[upperCode] ? upperCode : null);

        if (targetCode) {
            makineYukle(targetCode);
        } else {
            document.getElementById("m_baslik").innerText = "SÄ°STEME GÄ°RÄ°Å";
            document.getElementById("manuel-kutu").classList.remove("hidden");
        }
    };

    function makineYukle(kod) {
        const veri = hafiza[kod];
        document.getElementById("m_baslik").innerText = veri.ad;
        document.getElementById("m_kod").innerText = kod;
        document.getElementById("makine_id").value = kod;
        document.getElementById("makine_adi_gizli").value = veri.ad;
        
        document.getElementById("ana-header").style.background = "#2E7D32";
        document.getElementById("manuel-kutu").classList.add("hidden");
        document.getElementById("login-section").classList.remove("hidden");
    }

    function manuelSec() { 
        const kod = document.getElementById("manuel-secim").value; 
        if(kod) makineYukle(kod); 
    }

    function giris() {
        if(document.getElementById("pass").value === "1234") {
            document.getElementById("hidden_user").value = document.getElementById("p_name").value;
            document.getElementById("login-section").classList.add("hidden");
            document.getElementById("main-form").classList.remove("hidden");
        } else { alert("âŒ Åifre HatalÄ±!"); }
    }

    function periyotDegisti() {
        const p = document.getElementById("periyot_sec").value;
        const liste = document.getElementById("madde_listesi");
        const box = document.getElementById("madde_konteynir");
        const kod = document.getElementById("makine_id").value;
        liste.innerHTML = "";
        
        if(!p) { box.classList.add("hidden"); return; }
        box.classList.remove("hidden");

        // Periyot mantÄ±ÄŸÄ± (GÃ¼nlÃ¼k her zaman gelir, seÃ§ilen eklenir)
        let keys = ["GÃ¼nlÃ¼k"];
        if(p !== "GÃ¼nlÃ¼k") keys.push(p);

        keys.forEach(k => {
            if(hafiza[kod][k] && hafiza[kod][k].length > 0) {
                liste.innerHTML += `<div class="periyot-baslik">${k} Kontrolleri</div>`;
                hafiza[kod][k].forEach(m => {
                    // name="Yapilan_Islemler" eklendi (Veri gitmesi iÃ§in)
                    liste.innerHTML += `<div class="item"><input type="checkbox" class="ck" name="Yapilan_Islemler" value="[${k}] ${m}"><span>${m}</span></div>`;
                });
            }
        });
    }

    function val() {
        const cks = document.querySelectorAll(".ck");
        if(cks.length > 0 && !Array.from(cks).every(c=>c.checked)) {
            alert("ğŸ›‘ LÃ¼tfen tÃ¼m maddeleri iÅŸaretlemeden kaydetmeyin!"); return false;
        }
        alert("âœ… BakÄ±m KaydÄ± BaÅŸarÄ±yla GÃ¶nderildi!");
        setTimeout(()=>location.reload(), 2000);
        return true;
    }
</script>
</body>
</html>