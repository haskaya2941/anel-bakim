<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anel BakÄ±m Sistemi - V50</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #E0F2F1; display: flex; justify-content: center; padding: 15px; margin: 0; }
        .card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); width: 100%; max-width: 480px; overflow: hidden; border-top: 10px solid #009688; }
        .header { background: #009688; color: white; padding: 25px; text-align: center; transition: 0.4s; }
        .etiket { background: #FFD600; color: #333; padding: 6px 12px; border-radius: 6px; font-weight: 900; margin-top: 10px; font-size: 14px; display: inline-block; word-break: break-all; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .content { padding: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #00796B; font-size: 14px; }
        select, input, textarea, button { width: 100%; padding: 14px; margin-top: 8px; border: 1.5px solid #CFD8DC; border-radius: 10px; box-sizing: border-box; font-size: 16px; outline: none; }
        select:focus, input:focus { border-color: #009688; }
        button { background: #009688; color: white; border: none; font-weight: bold; cursor: pointer; height: 55px; margin-top: 25px; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,150,136,0.3); }
        button:hover { background: #00796B; transform: translateY(-2px); }
        .item { display: flex; align-items: flex-start; padding: 15px 0; border-bottom: 1px solid #ECEFF1; }
        input[type="checkbox"] { width: 28px; height: 28px; margin-right: 15px; accent-color: #009688; flex-shrink: 0; cursor: pointer; margin-top: 0; }
        .item span { font-size: 15px; color: #37474F; line-height: 1.4; }
        .hidden { display: none; }
        .periyot-baslik { background: #B2DFDB; padding: 10px; border-radius: 6px; font-size: 14px; margin-top: 20px; color: #004D40; font-weight: bold; border-left: 6px solid #00796B; }
        #manuel-alan { background: #FFF3E0; padding: 20px; border-radius: 12px; border: 1px solid #FFB74D; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header" id="ana-header">
        <h2 id="m_baslik" style="margin:0; font-size:20px;">SÄ°STEM YÃœKLENÄ°YOR...</h2>
        <div id="m_kod" class="etiket">---</div>
    </div>

    <div class="content">
        <div id="manuel-alan" class="hidden">
            <p style="color:#E65100; font-weight:bold; margin-top:0;">âš ï¸ Makine BulunamadÄ±</p>
            <p style="font-size:13px; color:#6D4C41;">Okutulan kod sistemde yok. LÃ¼tfen listeden seÃ§in:</p>
            <select id="manuel-secim" onchange="manuelSec()">
                <option value="">Listedeki TÃ¼m Makineler...</option>
            </select>
        </div>

        <div id="login-section" class="hidden">
            <label>BAKIM YAPAN PERSONEL:</label>
            <select id="p_name">
                <option value="Hasan Kaya">Hasan Kaya</option>
                <option value="Sami Kaya">Sami Kaya</option>
                <option value="Ahmet YÄ±lmaz">Ahmet YÄ±lmaz</option>
                <option value="Mehmet Demir">Mehmet Demir</option>
                <option value="OperatÃ¶r">OperatÃ¶r</option>
            </select>
            <label>GÃœVENLÄ°K ÅÄ°FRESÄ°:</label>
            <input type="number" id="pass" placeholder="Åifrenizi Girin (1234)">
            <button onclick="giris()">SÄ°STEME GÄ°RÄ°Å YAP</button>
        </div>

        <form id="main-form" class="hidden" method="POST" action="https://script.google.com/macros/s/AKfycbyUBmqtWUdCGIXp6WXEBuUkqwWhN5W38K7q1prjb-zKaHr7dr4Pyoc8Hxh9K_rYmjT3/exec" target="gizli_frame" onsubmit="return val()">
            <input type="hidden" name="Makine" id="makine_id">
            <input type="hidden" name="Personel" id="hidden_user">
            
            <label>BAKIM PERÄ°YODUNU SEÃ‡Ä°N:</label>
            <select name="Periyot" id="periyot_sec" onchange="periyotDegisti()" required>
                <option value="">SeÃ§iniz...</option>
                <option value="GÃ¼nlÃ¼k">GÃ¼nlÃ¼k BakÄ±m</option>
                <option value="HaftalÄ±k">HaftalÄ±k BakÄ±m (+GÃ¼nlÃ¼k)</option>
                <option value="AylÄ±k">AylÄ±k BakÄ±m (+HaftalÄ±k+GÃ¼nlÃ¼k)</option>
                <option value="3 AylÄ±k">3 AylÄ±k BakÄ±m</option>
                <option value="6 AylÄ±k">6 AylÄ±k BakÄ±m</option>
                <option value="YÄ±llÄ±k">YÄ±llÄ±k BakÄ±m</option>
            </select>

            <div id="madde_konteynir" class="hidden">
                <div id="madde_listesi"></div>
                
                <label>VARSA ARIZA / NOTUNUZ:</label>
                <textarea name="Notlar" rows="3" placeholder="ParÃ§a deÄŸiÅŸimi veya arÄ±za varsa belirtin..."></textarea>
                
                <button type="submit" id="gonder-btn">âœ… BAKIMI KAYDET VE BÄ°TÄ°R</button>
            </div>
        </form>
    </div>
</div>

<iframe name="gizli_frame" style="display:none;"></iframe>

<script>
    // --- 266 MAKÄ°NE VERÄ°SÄ° VE QR EÅLEÅTÄ°RMELERÄ° ---
    // (AÅŸaÄŸÄ±daki listeyi Python otomatik gÃ¼nceller ama ben temel yapÄ±yÄ± kurdum)
    const hafiza = {
        "S-APR.A33.025": {"ad": "4'lÃ¼ YÃ¼zey Ä°kaz LambasÄ± Kapak Ã‡akma", "GÃ¼nlÃ¼k": ["Genel temizlik", "Hava basÄ±ncÄ± kontrolÃ¼"], "HaftalÄ±k": ["Piston mili yaÄŸlama"]},
        "S-MKN.A01.11.09": {"ad": "TaÅŸÄ±nabilir KonveyÃ¶r", "GÃ¼nlÃ¼k": ["Bant gerginliÄŸi", "Acil stop testi"], "HaftalÄ±k": ["Motor rulman sesi"]},
        "S-MKN.A02.01.06": {"ad": "Enjeksiyon Makinesi No:6", "GÃ¼nlÃ¼k": ["YaÄŸ seviyesi", "Mengene temizliÄŸi"], "HaftalÄ±k": ["KolonlarÄ±n yaÄŸlanmasÄ±"]}
        // Python kodu buraya 266 tanesini dizecek
    };

    const qrMap = {
        "1": "S-APR.A33.025",
        "120": "S-MKN.A01.11.09",
        "129": "S-MKN.A02.01.06"
        // Python kodu buraya tÃ¼m QR eÅŸleÅŸmelerini dizecek
    };

    window.onload = function() {
        // 1. Manuel listeyi doldur
        const select = document.getElementById("manuel-secim");
        Object.keys(hafiza).sort().forEach(k => {
            let opt = document.createElement("option");
            opt.value = k;
            opt.text = k + " - " + hafiza[k].ad.substring(0, 35);
            select.appendChild(opt);
        });

        // 2. QR koddan gelen veriyi yakala
        let path = window.location.pathname.split("/").pop().replace(".html", "").trim();
        let hedef = qrMap[path] || (hafiza[path.toUpperCase()] ? path.toUpperCase() : null);

        if (hedef) {
            makineYukle(hedef);
        } else {
            document.getElementById("m_baslik").innerText = "SÄ°STEME GÄ°RÄ°Å";
            document.getElementById("manuel-alan").classList.remove("hidden");
        }
    };

    function makineYukle(kod) {
        const veri = hafiza[kod];
        document.getElementById("m_baslik").innerText = veri.ad;
        document.getElementById("m_kod").innerText = kod;
        document.getElementById("makine_id").value = kod;
        
        document.getElementById("ana-header").style.background = "#2E7D32";
        document.getElementById("manuel-alan").classList.add("hidden");
        document.getElementById("login-section").classList.remove("hidden");
    }

    function manuelSec() {
        let k = document.getElementById("manuel-secim").value;
        if(k) makineYukle(k);
    }

    function giris() {
        if(document.getElementById("pass").value === "1234") {
            document.getElementById("hidden_user").value = document.getElementById("p_name").value;
            document.getElementById("login-section").classList.add("hidden");
            document.getElementById("main-form").classList.remove("hidden");
        } else {
            alert("âŒ HatalÄ± Åifre!");
        }
    }

    function periyotDegisti() {
        const p = document.getElementById("periyot_sec").value;
        const liste = document.getElementById("madde_listesi");
        const box = document.getElementById("madde_konteynir");
        const kod = document.getElementById("makine_id").value;
        liste.innerHTML = "";
        
        if(!p) { box.classList.add("hidden"); return; }
        box.classList.remove("hidden");

        let seciliPeriyotlar = ["GÃ¼nlÃ¼k"];
        if(p !== "GÃ¼nlÃ¼k") seciliPeriyotlar.push(p);

        seciliPeriyotlar.forEach(pk => {
            if(hafiza[kod][pk] && hafiza[kod][pk].length > 0) {
                liste.innerHTML += `<div class="periyot-baslik">${pk} Kontrol Maddeleri</div>`;
                hafiza[kod][pk].forEach((m, i) => {
                    // name="Yapilan_Islemler" BURASI VERÄ°NÄ°N GÄ°TMESÄ°NÄ° SAÄLAR
                    liste.innerHTML += `
                        <div class="item">
                            <input type="checkbox" class="ck" name="Yapilan_Islemler" value="[${pk}] ${m}">
                            <span>${m}</span>
                        </div>`;
                });
            }
        });
    }

    function val() {
        const cks = document.querySelectorAll(".ck");
        if(cks.length > 0 && !Array.from(cks).every(c => c.checked)) {
            alert("ğŸ›‘ LÃ¼tfen tÃ¼m bakÄ±m maddelerini kontrol edip iÅŸaretleyiniz!");
            return false;
        }
        document.getElementById("gonder-btn").innerText = "GÃ–NDERÄ°LÄ°YOR...";
        document.getElementById("gonder-btn").disabled = true;
        alert("âœ… BakÄ±m kaydÄ± baÅŸarÄ±yla gÃ¶nderildi!");
        setTimeout(() => location.reload(), 2000);
        return true;
    }
</script>
</body>
</html>
