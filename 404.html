
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anel Bakım Sistemi</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #E0F2F1; display: flex; justify-content: center; padding: 15px; margin: 0; }
        .card { background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 100%; max-width: 450px; border-top: 8px solid #009688; }
        .header { background: #009688; color: white; padding: 20px; text-align: center; }
        .etiket { background: #FFD600; color: #333; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 14px; display:inline-block; margin-top:5px; }
        select, input, textarea, button { width: 100%; padding: 12px; margin-top: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        button { background: #009688; color: white; font-weight: bold; cursor: pointer; height: 50px; }
        .item { display: flex; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid #eee; }
        input[type="checkbox"] { width: 25px; height: 25px; margin-right: 10px; flex-shrink: 0; }
        .hidden { display: none; }
        .periyot-baslik { background: #B2DFDB; padding: 8px; border-radius: 5px; font-size: 14px; margin-top: 15px; color: #004D40; font-weight: bold; }
    </style>
</head>
<body>
<div class="card">
    <div class="header">
        <h2 id="m_baslik" style="margin:0; font-size:18px;">BAKIM FORMU</h2>
        <div id="m_kod" class="etiket">---</div>
    </div>
    <div class="content" style="padding:20px;">
        
        <div id="manuel-secim-alani">
            <label>Makine Listesi (Eğer QR okumadıysa):</label>
            <select id="manuel-secim" onchange="manuelSec()"><option value="">Seçiniz...</option></select>
        </div>

        <div id="login-section" class="hidden">
            <label>Personel:</label>
            <select id="p_name">
                <option value="Hasan Kaya">Hasan Kaya</option>
                <option value="Sami Kaya">Sami Kaya</option>
                <option value="Operatör">Operatör</option>
            </select>
            <input type="number" id="pass" placeholder="Şifre (1234)">
            <button onclick="giris()">GİRİŞ YAP</button>
        </div>

        <form id="main-form" class="hidden" method="POST" action="https://script.google.com/macros/s/AKfycbxwbaWlONxDlF997CP4wF7GfyG38kb4okyl_MlNqd9LOHpNpS5HkQrGsFRNDvLqix5D/exec" target="gizli_frame" onsubmit="return val()">
            <input type="hidden" name="Makine" id="makine_id">
            <input type="hidden" name="MakineAdi" id="makine_adi_gizli">
            <input type="hidden" name="Personel" id="hidden_user">
            
            <label>Bakım Periyodu:</label>
            <select name="Periyot" id="periyot_sec" onchange="periyotDegisti()" required>
                <option value="">Seçiniz...</option>
                <option value="Günlük">Günlük Bakım</option>
                <option value="Haftalık">Haftalık Bakım</option>
                <option value="Aylık">Aylık Bakım</option>
                <option value="3 Aylık">3 Aylık Bakım</option>
                <option value="6 Aylık">6 Aylık Bakım</option>
                <option value="Yıllık">Yıllık Bakım</option>
            </select>

            <div id="madde_konteynir" class="hidden">
                <div id="madde_listesi"></div>
                <textarea name="Notlar" rows="3" placeholder="Notlar..."></textarea>
                <button type="submit" style="background:#D32F2F; margin-top:15px;">✅ KAYDET</button>
            </div>
        </form>
    </div>
</div>
<iframe name="gizli_frame" style="display:none;"></iframe>

<script>
    // ÖRNEK VERİLER (Sende 266 tane olacak)
    const hafiza = {
        "S-APR.A33.025": {"ad": "4'lü Yüzey İkaz Lambası (VBE) Kapak Çakma Apr.", "Günlük": ["Hava kaçağı kontrolü", "Piston temizliği"]},
        "S-APR.A33.174": {"ad": "Dometic Gövde Terminal Çakma Aparatı", "Günlük": ["Basınç kontrolü"]}
    };

    window.onload = function() {
        const sel = document.getElementById("manuel-secim");
        Object.keys(hafiza).sort().forEach(k => {
            let opt = document.createElement("option"); opt.value = k; opt.text = k + " - " + hafiza[k].ad.substring(0,30); sel.appendChild(opt);
        });

        let path = window.location.pathname.split("/").pop().replace(".html", "").toUpperCase();
        if(hafiza[path]) makineYukle(path);
    };

    function makineYukle(kod) {
        document.getElementById("m_baslik").innerText = hafiza[kod].ad;
        document.getElementById("m_kod").innerText = kod;
        document.getElementById("makine_id").value = kod;
        document.getElementById("makine_adi_gizli").value = hafiza[kod].ad; // Script'e giden isim
        document.getElementById("login-section").classList.remove("hidden");
    }

    function manuelSec() { let k = document.getElementById("manuel-secim").value; if(k) makineYukle(k); }

    function giris() {
        if(document.getElementById("pass").value === "1234") {
            document.getElementById("hidden_user").value = document.getElementById("p_name").value;
            document.getElementById("login-section").classList.add("hidden");
            document.getElementById("main-form").classList.remove("hidden");
        } else { alert("Şifre Hatalı!"); }
    }

    function periyotDegisti() {
        const p = document.getElementById("periyot_sec").value;
        const liste = document.getElementById("madde_listesi");
        const kod = document.getElementById("makine_id").value;
        liste.innerHTML = "";
        if(!p) return;
        document.getElementById("madde_konteynir").classList.remove("hidden");

        if(hafiza[kod][p]) {
            liste.innerHTML += `<div class="periyot-baslik">${p} Maddeleri</div>`;
            hafiza[kod][p].forEach(m => {
                liste.innerHTML += `<div class="item"><input type="checkbox" class="ck" name="Yapilan_Islemler" value="${m}"><span>${m}</span></div>`;
            });
        }
    }

    function val() {
        const cks = document.querySelectorAll(".ck");
        if(cks.length > 0 && !Array.from(cks).every(c=>c.checked)) {
            alert("⚠️ Maddeleri işaretleyin!"); return false;
        }
        alert("✅ Gönderildi!");
        setTimeout(()=>location.reload(), 2000);
        return true;
    }
</script>
</body>
</html>